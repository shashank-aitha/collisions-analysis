---
title: "Collisions Analysis"
author: "Leo Li, Shashank Aitha, Max Lai, Belinda Zhu"
date: "2023-09-21"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
Introduction: This data set consists of every police reported motor vehicle collision in New York City from 2014. It contains information on 2 million accidents. Within each reported accident we have access to the various contributing factors, vehicle types, time, location, and other details regarding the crash. Our goal is to develop a predictive model to assess the likelihood of an injury or fatality based on variables such as the type of vehicle, time of the incident, and the reason for the crash.
```{r}
getwd()
data <- read.csv("Motor_Vehicle_Collisions_-_Crashes.csv")
print(head(data, 100))
```


## Pie Chart
Demonstrate the proportions of contributing factors to collisions.

```{r}
causes <- table(data$CONTRIBUTING.FACTOR.VEHICLE.1)
causes <- causes[!names(causes) == "" & !names(causes) == "Unspecified"]
causes <- causes[causes >= 20000]
par(mar = c(1, 1, 1, 1))
pie(causes, labels = names(causes), main = "Contributing Factors", cex = 0.3)
```
We observe that the most common contributing factor to vehicle collisions in
NYC is unspecified, followed by driver inattention. This makes sense, as lack
of driver attention is a very broad category that can be applied to a wide
number of collisions.

## Histogram

Demonstrate the number of collisions happened on different boroughs.

```{r}
bor <- table(data$BOROUGH)
bor <- bor[!names(bor) == ""]

barplot(bor, 
        names.arg = names(bor),
        cex.names = 0.8,
        main = "ACCIDENT BOROUGH",
        xlab = "Borough",
        ylab = "Frequency",
        col = "lightblue"
)

```
We see that the largest number of collisions happen in Brooklyn and Queens, as
they have the highest bars. Meanwhile, Staten Island has the least number of
collisions. This makes sense, as Brooklyn and Queens have by far the greatest
area by land of the NYC boroughs, while Staten Island has a significantly
lower population than the other boroughs.

## Line Chart

Demonstrate the trend of number of collisions happened in each month.

```{r}
data$CRASH.DATE <- as.Date(data$CRASH.DATE, format="%m/%d/%Y")
month <- format(data$CRASH.DATE, "%Y-%m")
month_counts <- table(month)
month_counts_df <- data.frame(Month = names(month_counts), Count = as.numeric(month_counts))
month_counts_df <- month_counts_df[order(month_counts_df$Month), ]

plot(seq(length(month_counts_df$Month)), month_counts_df$Count, type = "l", xlab = "Month",
     ylab = "Number of Occurrences", main = "Number of Occurrences of Motor Vehicle Collisions by Month",
     xaxt = "n")
axis(1, at = seq(length(month_counts_df$Month)), labels = month_counts_df$Month, las = 2, cex.axis = 0.7)
```
We see that the line graph fluctuates at a relatively high number of collisions 
for the first few years, and then it sharply drops in 2020. From there, it
fluctuates at a relatively low number of collisions for the remainder of the
years.

## Scatter Plot

Demonstrate the number of collisions happened in each day.

```{r}
day_counts <- table(data$CRASH.DATE)
day_counts_df <- as.data.frame(day_counts)
colnames(day_counts_df) <- c("Date", "Count")
day_counts_df <- day_counts_df[order(day_counts_df$Date), ]

plot(day_counts_df$Date, day_counts_df$Count, xlab = "Date",
     ylab = "Number of Occurrences", main = "Number of Occurrences of Motor Vehicle Collisions by Day")
```
We see that the dotplot fluctuates at a relatively high number of collisions 
for the first few years, and then it sharply drops in 2020. From there, it
fluctuates at a relatively low number of collisions for the remainder of the
years. Moreover, during this "low collisions" period, the day-to-day fluctuations
fluctuate at a lower magnitude.

## Heatmap

Demonstrate two drivers' collision cause types and the corresponding frequency of such accidents.

```{r}
not_empty <- data[!data$CONTRIBUTING.FACTOR.VEHICLE.1 == "" & !data$CONTRIBUTING.FACTOR.VEHICLE.2 == "" &
                    !data$CONTRIBUTING.FACTOR.VEHICLE.1 == "Unspecified" & !data$CONTRIBUTING.FACTOR.VEHICLE.2 == "Unspecified" &
                    !data$CONTRIBUTING.FACTOR.VEHICLE.1 == "1" & !data$CONTRIBUTING.FACTOR.VEHICLE.2 == "1" &
                    !data$CONTRIBUTING.FACTOR.VEHICLE.1 == "80" & !data$CONTRIBUTING.FACTOR.VEHICLE.2 == "80",]
vehicle_counts <- table(not_empty$CONTRIBUTING.FACTOR.VEHICLE.1, not_empty$CONTRIBUTING.FACTOR.VEHICLE.2)
vehicle_counts <- as.matrix(vehicle_counts)

heatmap(vehicle_counts, cexRow = 0.4, cexCol = 0.4, Colv=NA, Rowv=NA, main = "Cause Types and Corresponding Frequency")
```
We see in this heat map that the most common cause type for collisions in
NYC is "unspecified", while there are some combinations such as traffic device
malfunction and inappropriate markings that have relatively higher frequencies
than other combinations.

## Box Plot

Demonstrate the distribution of the hour of the day when the collisions happen.

```{r}
hour <- as.integer(sub(":.*", "", data$CRASH.TIME))

boxplot(hour, horizontal = TRUE, main = "Collision Time by Hour", xlab = "Hour of the Day")
```
We see that the median hour of collisions for these car collisions in NYC
is around 2 PM; the interquartile range is from about 9 AM to about 6 PM.
This makes sense, as these are the waking hours in which people are most active.
Moreover, since 2 PM is in the middle of this range, it makes sense that the
median collision time would be somewhere around that time.

This is a logistic regression model that predicts probability of a collision in Brooklyn that is based on the hour of the day
```{r}
data$isBrooklyn <- as.numeric(data$BOROUGH == "BROOKLYN")

data$hour <- as.integer(sub(":.*", "", data$CRASH.TIME))

model <- glm(isBrooklyn ~ hour, family="binomial", data=data)
new_data <- data.frame(hour = 0:23) 
predicted_probabilities <- predict(model, newdata=new_data, type="response")

results <- data.frame(
  HOUR = 0:23,
  Probability_Of_Collision_In_Brooklyn = predicted_probabilities
)

print(results)

```

